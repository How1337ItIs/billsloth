#!/bin/bash
# Bill Sloth System Updater - One command to refresh everything

echo "ðŸ”„ BILL SLOTH SYSTEM UPDATE"
echo "==========================="

# Git pull to get latest changes
echo "ðŸ“¡ Pulling latest changes..."
if git pull origin main; then
    echo "âœ… Code updated successfully"
else
    echo "âš ï¸  Git pull failed - continuing with local refresh"
fi

# Make everything executable
echo "ðŸ”§ Setting permissions..."
chmod +x bin/* 2>/dev/null || echo "âš ï¸  Some bin files may not exist yet"
chmod +x modules/*.sh 2>/dev/null || echo "âš ï¸  Some modules may not exist yet"
chmod +x lib/*.sh 2>/dev/null || echo "âš ï¸  Some lib files may not exist yet"

# Create directories if missing
echo "ðŸ“ Creating directories..."
mkdir -p ~/.bill-sloth/{logs,backups,data,audit}
mkdir -p ~/bin ~/BillSloth

# Source aliases if they exist
if [ -f shortcuts/aliases.sh ]; then
    echo "ðŸ”— Loading aliases..."
    echo "Run 'source ~/BillSloth/shortcuts/aliases.sh' to activate shortcuts"
else
    echo "â„¹ï¸  No aliases file found"
fi

# Check system health
echo "ðŸ¥ Quick system check..."
if command -v glances &> /dev/null; then
    echo "âœ… Glances (system monitor) available"
else
    echo "ðŸ“¦ Consider installing: sudo apt install glances"
fi

if command -v docker &> /dev/null; then
    echo "âœ… Docker available for container deployments"
else
    echo "ðŸ“¦ Consider installing: curl -fsSL https://get.docker.com | sudo bash"
fi

echo ""
echo "ðŸŽ‰ Update complete!"
echo "ðŸ“‹ Available commands:"
echo "â€¢ ./lab.sh - Main interface"
echo "â€¢ audit_workflow <module> - Audit any module"
echo "â€¢ update-all - Run this updater again"
echo ""
echo "ðŸš€ Ready to go! Run './lab.sh' to start."