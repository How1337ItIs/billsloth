#!/bin/bash
# Bill Sloth Voice Interface - ATHF Meatwad Style
# "I understand! I understand!"

echo "ğŸ¤ MEATWAD VOICE INTERFACE ACTIVATED!"
echo "======================================="
echo ""
echo "ğŸ” Meatwad: 'I understand! Tell me what you want to do!'"
echo ""

# Check if speech tools are installed
if ! command -v espeak &> /dev/null; then
    echo "Installing voice tools..."
    sudo apt install -y espeak espeak-data alsa-utils
fi

# Meatwad greeting
espeak -s 120 -p 50 "I understand! I understand! What do you want to do?" 2>/dev/null &

echo "ğŸ™ï¸ Say what you want to do (or type it):"
echo ""
echo "Example commands:"
echo "â€¢ 'update system' - Updates everything"
echo "â€¢ 'fix audio' - Fixes sound problems"  
echo "â€¢ 'check vpn' - Checks VPN status"
echo "â€¢ 'start streaming' - Sets up streaming"
echo "â€¢ 'gaming mode' - Optimizes for gaming"
echo "â€¢ 'data hoarding' - Opens treasure hunting"
echo "â€¢ 'brain dump' - Capture racing thoughts"
echo "â€¢ 'frylock help' - Show all commands"
echo ""

while true; do
    echo -n "ğŸ” Meatwad is listening: "
    read -r command
    
    # Log for pattern learning AND capability tracking
    ~/bin/bill-brain log "voice_command_$(echo "$command" | tr ' ' '_')"
    ~/bin/capability-tracker voice "$command"
    
    # FIRST: Try local-first router to save tokens!
    echo "ğŸ§  Checking local solutions first..."
    local_result=$(~/bin/local-first-router "$command" 2>/dev/null)
    
    if echo "$local_result" | grep -q "Can handle locally"; then
        echo "ğŸ’° Handled locally - tokens saved!"
        echo ""
        continue
    fi
    
    # Convert to lowercase for ATHF character responses
    command_lower=$(echo "$command" | tr '[:upper:]' '[:lower:]')
    
    case "$command_lower" in
        *"update"*|*"upgrade"*)
            espeak "Updating the system! I understand!" 2>/dev/null &
            echo "ğŸ” Meatwad: 'I'll update everything for you!'"
            source ~/BillSloth/modules/system_ops.sh && update_everything
            ;;
        *"audio"*|*"sound"*|*"fix"*)
            espeak "Fixing the audio! Dancing is forbidden!" 2>/dev/null &
            echo "ğŸ” Meatwad: 'I'll make the sounds work!'"
            source ~/BillSloth/modules/system_ops.sh && fix_audio
            ;;
        *"vpn"*|*"safe"*)
            espeak "Checking VPN status!" 2>/dev/null &
            echo "ğŸ” Meatwad: 'Let me check if we're safe!'"
            source ~/BillSloth/modules/privacy_tools.sh && check_vpn_status
            ;;
        *"stream"*|*"obs"*)
            espeak "Starting streaming mode!" 2>/dev/null &
            echo "ğŸ” Meatwad: 'Time to be famous!'"
            source ~/BillSloth/modules/streaming_setup.sh && create_stream_command && ~/bin/stream
            ;;
        *"game"*|*"gaming"*)
            espeak "Gaming mode activated!" 2>/dev/null &
            echo "ğŸ” Meatwad: 'Let's play games!'"
            source ~/BillSloth/modules/gaming_boost.sh && ~/bin/game
            ;;
        *"data"*|*"torrent"*|*"pirate"*|*"treasure"*)
            espeak "Ahoy! Time for treasure hunting!" 2>/dev/null &
            echo "ğŸ” Meatwad: 'I don't get pirates but I'll help!'"
            ~/bin/data-dashboard
            ;;
        *"brain"*|*"dump"*|*"thoughts"*|*"adhd"*)
            espeak "Brain dump time! Get those thoughts out!" 2>/dev/null &
            echo "ğŸ” Meatwad: 'Tell me everything in your head!'"
            ~/bin/brain-dump
            ;;
        *"ai"*|*"ollama"*)
            espeak "Starting AI assistant!" 2>/dev/null &
            echo "ğŸ” Meatwad: 'Talking to robot friends!'"
            source ~/BillSloth/modules/ai_playground.sh && create_ai_shortcuts && ~/bin/ai
            ;;
        *"creative"*|*"vibe"*|*"art"*)
            espeak "Creative mode activated!" 2>/dev/null &
            echo "ğŸ” Meatwad: 'Time to make pretty things!'"
            source ~/BillSloth/modules/creative_coding.sh && ~/bin/vibe
            ;;
        *"towel"*|*"drape"*)
            espeak "Don't drape that towel on my computer!" 2>/dev/null &
            echo "ğŸ§  Frylock: 'Don't drape that towel on my computer!'"
            echo "ğŸ§  Frylock: 'That is a precision instrument!'"
            ;;
        *"help"*|*"frylock"*|*"commands"*)
            echo ""
            echo "ğŸ§  FRYLOCK'S COMPREHENSIVE COMMAND LIST:"
            echo "========================================"
            echo ""
            echo "ğŸ”§ SYSTEM COMMANDS:"
            echo "â€¢ 'update system' - Full system update"
            echo "â€¢ 'fix audio' - Restart audio services"
            echo "â€¢ 'check health' - System health check"
            echo "â€¢ 'clean system' - Remove old files"
            echo ""
            echo "ğŸ® ENTERTAINMENT:"
            echo "â€¢ 'gaming mode' - Optimize for games"
            echo "â€¢ 'start streaming' - Set up OBS"
            echo "â€¢ 'creative mode' - p5.js coding"
            echo "â€¢ 'ai chat' - Talk to AI"
            echo ""
            echo "ğŸ´â€â˜ ï¸ DATA HOARDING:"
            echo "â€¢ 'data hoarding' - Pirate treasure dashboard"
            echo "â€¢ 'check vpn' - VPN safety check"
            echo "â€¢ 'torrent safe' - Safe torrenting"
            echo ""
            echo "ğŸ§  PRODUCTIVITY:"
            echo "â€¢ 'brain dump' - Capture thoughts"
            echo "â€¢ 'task board' - View todos"
            echo "â€¢ 'focus timer' - Pomodoro timer"
            echo "â€¢ 'work mode' - Context switching"
            echo ""
            echo "ğŸ” MEATWAD COMMANDS:"
            echo "â€¢ 'dance' - I like to dance!"
            echo "â€¢ 'boat' - I am not a boat"
            echo "â€¢ 'understand' - I understand!"
            echo ""
            echo "ğŸ§  FRYLOCK COMMANDS:"
            echo "â€¢ 'towel' - Don't drape that towel on my computer!"
            echo ""
            echo "ğŸ‘¨ CARL COMMANDS:"
            echo "â€¢ 'computer expert' - Carl's tech wisdom"
            echo ""
            echo "ğŸ§™ WWWYZZERDD COMMANDS:"
            echo "â€¢ 'wizard' - The infamous internet wizard"
            echo "â€¢ 'supervisor' - Fake customer service"
            echo "â€¢ 'broadbrain' - Primitive internet references"
            ;;
        *"dance"*)
            espeak "I like to dance! Dancing is forbidden!" 2>/dev/null &
            echo "ğŸ” Meatwad: 'I like to dance! But dancing is forbidden...'"
            ;;
        *"boat"*)
            espeak "I am not a boat! I am a ball of meat!" 2>/dev/null &
            echo "ğŸ” Meatwad: 'I am not a boat! I am Meatwad!'"
            ;;
        *"understand"*)
            espeak "I understand! I understand!" 2>/dev/null &
            echo "ğŸ” Meatwad: 'I get it! It ain't making me laugh, but I get it!'"
            ;;
        *"wizard"*|*"wwwyzzerdd"*)
            espeak "It is I, the wwwyzzerdd. D-d-d-d." 2>/dev/null &
            echo "ğŸ§™ wwwyzzerdd: 'It is I, the wwwyzzerdd.'"
            echo "ğŸ§™ wwwyzzerdd: 'There are 2 zs, 2 ds, and 3 ws. Get it straight.'"
            ;;
        *"supervisor"*)
            espeak "I'm the supervisor. What seems to be the problem?" 2>/dev/null &
            echo "ğŸ§™ wwwyzzerdd: 'I'm the supervisor. What seems to be the problem?'"
            echo "ğŸ§  Frylock: 'You're the same damn guy! You just put on another beard and mustache.'"
            ;;
        *"broadbrain"*|*"brainframe"*)
            espeak "You are not on the brainframe." 2>/dev/null &
            echo "ğŸ§™ wwwyzzerdd: 'You are not on the brainframe.'"
            echo "ğŸ§™ wwwyzzerdd: 'This is live streaming, broadbrrrain.'"
            ;;
        *"exit"*|*"quit"*|*"bye"*)
            espeak "Goodbye! I understand!" 2>/dev/null &
            echo "ğŸ” Meatwad: 'Bye! I understand!'"
            break
            ;;
        "")
            echo "ğŸ” Meatwad: 'You didn't say anything... I understand!'"
            ;;
        *"plaque"*|*"teeth"*)
            espeak "Plaque is a figment of the liberal media!" 2>/dev/null &
            echo "ğŸ¥¤ Shake: 'Plaque is a figment of the liberal media and the dental industry to scare you into buying useless appliances and pastes.'"
            echo "ğŸ¥¤ Shake: 'I've read the arguments on both sides, and I haven't found any evidence yet to support the need to brush your teeth. Ever.'"
            ;;
        *"crime lab"*)
            espeak "Come on. To the crime lab!" 2>/dev/null &
            echo "ğŸ¥¤ Shake: 'Come on. To the crime lab!'"
            echo "ğŸ” Meatwad: 'Frylock says this ain't the crime lab, and this is his room, and he don't like us in it.'"
            ;;
        *)
            espeak "I don't understand that one!" 2>/dev/null &
            echo "ğŸ” Meatwad: 'I don't get it! Say 'frylock help' for all commands!'"
            ;;
    esac
    
    echo ""
done

echo "ğŸ” Meatwad voice interface deactivated. I understand!"